<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gear Genix â€” College Equipment Booking</title>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg-base:      #0f172a;
      --bg-sidebar:   #0b1120;
      --bg-chat:      #111827;
      --bg-input:     #1e293b;
      --bg-user-msg:  #1d4ed8;
      --bg-bot-msg:   #1e293b;
      --bg-btn:       #1e293b;
      --bg-btn-hover: #273549;
      --accent:       #3b82f6;
      --accent-light: #60a5fa;
      --text-primary: #f1f5f9;
      --text-muted:   #94a3b8;
      --border:       #1e293b;
      --radius:       12px;
      --sidebar-w:    280px;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: var(--bg-base);
      color: var(--text-primary);
      height: 100vh;
      display: flex;
      overflow: hidden;
    }

    /* â”€â”€ Sidebar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .sidebar {
      width: var(--sidebar-w);
      min-width: var(--sidebar-w);
      background: var(--bg-sidebar);
      border-right: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      padding: 24px 16px;
      gap: 24px;
    }

    .sidebar-header h1 {
      font-size: 1.4rem;
      font-weight: 700;
      color: var(--accent-light);
      letter-spacing: -0.02em;
    }

    .sidebar-header p {
      font-size: 0.8rem;
      color: var(--text-muted);
      margin-top: 4px;
      line-height: 1.5;
    }

    .sidebar-section-title {
      font-size: 0.7rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-muted);
      margin-bottom: 8px;
    }

    .quick-actions {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .mobile-quick-actions {
      display: none;
    }

    .quick-btn {
      background: var(--bg-btn);
      border: 1px solid var(--border);
      color: var(--text-primary);
      border-radius: 8px;
      padding: 9px 12px;
      font-size: 0.83rem;
      cursor: pointer;
      text-align: left;
      transition: background 0.15s, border-color 0.15s;
    }

    .quick-btn:hover {
      background: var(--bg-btn-hover);
      border-color: var(--accent);
    }

    .sidebar-footer {
      margin-top: auto;
      font-size: 0.72rem;
      color: var(--text-muted);
      line-height: 1.6;
    }

    /* â”€â”€ Chat panel â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .chat-panel {
      flex: 1;
      display: flex;
      flex-direction: column;
      background: var(--bg-chat);
      overflow: hidden;
    }

    .chat-topbar {
      padding: 16px 20px;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      gap: 10px;
      background: var(--bg-sidebar);
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #22c55e;
      flex-shrink: 0;
    }

    .chat-topbar-title {
      font-size: 0.95rem;
      font-weight: 600;
    }

    .chat-topbar-sub {
      font-size: 0.75rem;
      color: var(--text-muted);
      margin-left: auto;
    }

    /* â”€â”€ Messages â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .messages {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      scroll-behavior: smooth;
    }

    .messages::-webkit-scrollbar { width: 5px; }
    .messages::-webkit-scrollbar-track { background: transparent; }
    .messages::-webkit-scrollbar-thumb { background: #334155; border-radius: 3px; }

    .msg-row {
      display: flex;
      align-items: flex-end;
      gap: 8px;
    }

    .msg-row.user { flex-direction: row-reverse; }

    .avatar {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      font-weight: 700;
      flex-shrink: 0;
    }

    .avatar.bot  { background: var(--accent);   color: #fff; }
    .avatar.user { background: #4f46e5; color: #fff; }

    .bubble {
      max-width: 68%;
      padding: 10px 14px;
      border-radius: var(--radius);
      font-size: 0.88rem;
      line-height: 1.6;
      word-break: break-word;
      white-space: pre-wrap;
    }

    .msg-row.bot  .bubble { background: var(--bg-bot-msg); border-bottom-left-radius: 4px; }
    .msg-row.user .bubble { background: var(--bg-user-msg); border-bottom-right-radius: 4px; color: #fff; }

    /* typing indicator */
    .typing-dots {
      display: flex;
      gap: 4px;
      align-items: center;
      padding: 10px 14px;
      background: var(--bg-bot-msg);
      border-radius: var(--radius);
      border-bottom-left-radius: 4px;
      width: fit-content;
    }

    .typing-dots span {
      width: 7px;
      height: 7px;
      border-radius: 50%;
      background: var(--text-muted);
      animation: bounce 1.2s infinite;
    }

    .typing-dots span:nth-child(2) { animation-delay: 0.2s; }
    .typing-dots span:nth-child(3) { animation-delay: 0.4s; }

    @keyframes bounce {
      0%, 80%, 100% { transform: translateY(0); opacity: 0.4; }
      40%            { transform: translateY(-6px); opacity: 1; }
    }

    /* â”€â”€ Input bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .input-bar {
      padding: 14px 20px;
      border-top: 1px solid var(--border);
      display: flex;
      gap: 10px;
      align-items: flex-end;
      background: var(--bg-sidebar);
    }

    .input-bar textarea {
      flex: 1;
      background: var(--bg-input);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 10px 14px;
      color: var(--text-primary);
      font: inherit;
      font-size: 0.88rem;
      resize: none;
      max-height: 120px;
      min-height: 42px;
      line-height: 1.5;
      transition: border-color 0.15s;
    }

    .input-bar textarea:focus {
      outline: none;
      border-color: var(--accent);
    }

    .input-bar textarea::placeholder { color: var(--text-muted); }

    .send-btn {
      width: 42px;
      height: 42px;
      border-radius: 50%;
      border: none;
      background: var(--accent);
      color: #fff;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      transition: background 0.15s, transform 0.1s;
    }

    .send-btn:hover   { background: #2563eb; }
    .send-btn:active  { transform: scale(0.93); }
    .send-btn:disabled { background: #334155; cursor: default; }

    .send-btn svg { width: 18px; height: 18px; fill: currentColor; }

    /* â”€â”€ Responsive â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    @media (max-width: 640px) {
      body {
        flex-direction: column;
        height: 100vh;
        overflow: hidden;
      }

      .sidebar {
        display: none;
      }

      .chat-panel {
        width: 100%;
      }

      .mobile-quick-actions {
        display: block;
        padding: 10px 12px 0;
        background: var(--bg-chat);
        border-bottom: 1px solid var(--border);
      }

      .mobile-quick-actions .sidebar-section-title {
        margin-bottom: 6px;
      }

      .mobile-quick-actions .quick-actions {
        flex-direction: row;
        overflow-x: auto;
        padding-bottom: 8px;
        gap: 8px;
      }

      .mobile-quick-actions .quick-btn {
        white-space: nowrap;
        flex-shrink: 0;
        font-size: 0.8rem;
      }

      /* keep last messages visible above fixed input bar */
      .messages {
        padding: 12px 12px 90px;
      }

      /* stick input bar to bottom of viewport on mobile */
      .input-bar {
        position: fixed;
        left: 0;
        right: 0;
        bottom: 0;
        padding: 10px 12px;
        border-top: 1px solid var(--border);
        background: var(--bg-sidebar);
      }
    }
  </style>
</head>
<body>

<!-- â”€â”€ Sidebar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<aside class="sidebar">
  <div class="sidebar-header">
    <h1>âš™ï¸ Gear Genix</h1>
    <p>College Equipment Booking Assistant â€” ask me anything in plain English.</p>
  </div>

  <div>
    <div class="sidebar-section-title">Quick Actions</div>
    <div class="quick-actions">
      <button class="quick-btn" onclick="prefill('What equipment do you have?')">ğŸ“¦ List Equipment</button>
      <button class="quick-btn" onclick="prefill('I want to book equipment for my club')">ğŸ“… Book Equipment</button>
      <button class="quick-btn" onclick="prefill('Show bookings for my club')">ğŸ“‹ View My Bookings</button>
      <button class="quick-btn" onclick="prefill('Show all active bookings')">ğŸ‘ Active Bookings</button>
      <button class="quick-btn" onclick="prefill('I want to return equipment for a booking')">ğŸ”„ Return Equipment</button>
    </div>
  </div>

  <div class="sidebar-footer">
    ğŸ’¡ Tip: tell me equipment name, date, time, club, and your name all at once for fastest booking.
  </div>
</aside>

<!-- â”€â”€ Chat panel â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<main class="chat-panel">
  <div class="chat-topbar">
    <div class="status-dot"></div>
    <span class="chat-topbar-title">Gear Genix</span>
    <span class="chat-topbar-sub" id="sessionLabel"></span>
  </div>

  <!-- Quick action shortcuts for mobile -->
  <div class="mobile-quick-actions">
    <div class="sidebar-section-title">Quick Actions</div>
    <div class="quick-actions">
      <button class="quick-btn" onclick="prefill('What equipment do you have?')">ğŸ“¦ List Equipment</button>
      <button class="quick-btn" onclick="prefill('I want to book equipment for my club')">ğŸ“… Book Equipment</button>
      <button class="quick-btn" onclick="prefill('Show bookings for my club')">ğŸ“‹ View My Bookings</button>
      <button class="quick-btn" onclick="prefill('Show all active bookings')">ğŸ‘ Active Bookings</button>
      <button class="quick-btn" onclick="prefill('I want to return equipment for a booking')">ğŸ”„ Return Equipment</button>
    </div>
  </div>

  <div class="messages" id="messages"></div>

  <div class="input-bar">
    <textarea
      id="input"
      placeholder="Ask me about equipment, bookings, availabilityâ€¦"
      rows="1"
    ></textarea>
    <button class="send-btn" id="sendBtn" title="Send">
      <svg viewBox="0 0 24 24"><path d="M2 21l21-9L2 3v7l15 2-15 2v7z"/></svg>
    </button>
  </div>
</main>

<script>
  // â”€â”€ Session management â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const sessionId = crypto.randomUUID();
  document.getElementById('sessionLabel').textContent = 'Session: ' + sessionId.slice(0, 8) + 'â€¦';

  // â”€â”€ DOM refs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const messagesEl = document.getElementById('messages');
  const inputEl    = document.getElementById('input');
  const sendBtn    = document.getElementById('sendBtn');

  // â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function scrollToBottom() {
    messagesEl.scrollTop = messagesEl.scrollHeight;
  }

  function appendMessage(text, role) {
    const row = document.createElement('div');
    row.className = 'msg-row ' + role;

    const av = document.createElement('div');
    av.className = 'avatar ' + role;
    av.textContent = role === 'bot' ? 'ğŸ¤–' : 'You';

    const bubble = document.createElement('div');
    bubble.className = 'bubble';
    // Preserve newlines and basic formatting
    bubble.innerHTML = text
      .replace(/&/g, '&amp;')
      .replace(/</g, '&lt;')
      .replace(/>/g, '&gt;')
      .replace(/\n/g, '<br>');

    row.appendChild(av);
    row.appendChild(bubble);
    messagesEl.appendChild(row);
    scrollToBottom();
    return bubble;
  }

  function showTyping() {
    const row = document.createElement('div');
    row.className = 'msg-row bot';
    row.id = 'typing-row';

    const av = document.createElement('div');
    av.className = 'avatar bot';
    av.textContent = 'ğŸ¤–';

    const dots = document.createElement('div');
    dots.className = 'typing-dots';
    dots.innerHTML = '<span></span><span></span><span></span>';

    row.appendChild(av);
    row.appendChild(dots);
    messagesEl.appendChild(row);
    scrollToBottom();
  }

  function hideTyping() {
    const el = document.getElementById('typing-row');
    if (el) el.remove();
  }

  function prefill(text) {
    inputEl.value = text;
    inputEl.focus();
    autoResize();
  }

  function autoResize() {
    inputEl.style.height = 'auto';
    inputEl.style.height = Math.min(inputEl.scrollHeight, 120) + 'px';
  }

  // â”€â”€ Send message â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function sendMessage() {
    const text = inputEl.value.trim();
    if (!text) return;

    appendMessage(text, 'user');
    inputEl.value = '';
    autoResize();
    sendBtn.disabled = true;
    showTyping();

    try {
      const res = await fetch('/chat', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ message: text, session_id: sessionId }),
      });

      hideTyping();

      if (!res.ok) {
        appendMessage('âš ï¸ Server error (' + res.status + '). Please try again.', 'bot');
      } else {
        const data = await res.json();
        appendMessage(data.response || '(no response)', 'bot');
      }
    } catch (err) {
      hideTyping();
      appendMessage('âš ï¸ Network error: ' + err.message, 'bot');
    } finally {
      sendBtn.disabled = false;
      inputEl.focus();
    }
  }

  // â”€â”€ Event listeners â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  sendBtn.addEventListener('click', sendMessage);

  inputEl.addEventListener('keydown', (e) => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      sendMessage();
    }
  });

  inputEl.addEventListener('input', autoResize);

  // â”€â”€ Welcome message on load â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  window.addEventListener('load', async () => {
    try {
      await fetch('/health');
    } catch (_) { /* ignore */ }
    appendMessage(
      "ğŸ‘‹ Welcome to Gear Genix â€” College Equipment Booking Assistant!\n\n" +
      "I can help you:\n" +
      "â€¢ ğŸ“¦ Check what equipment is available\n" +
      "â€¢ ğŸ” Check availability for a time slot\n" +
      "â€¢ ğŸ“… Book equipment for your club\n" +
      "â€¢ ğŸ“‹ View your club's bookings\n" +
      "â€¢ âŒ Cancel a booking\n" +
      "â€¢ ğŸ”„ Return equipment\n\n" +
      "Just tell me what you need in plain English!\n" +
      "Example: 'Is the projector free tomorrow 3-5pm?'",
      'bot'
    );
  });
</script>
</body>
</html>
