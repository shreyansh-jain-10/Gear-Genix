<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />

  <!-- CRITICAL: stops zoom + layout break -->
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"
  />

  <title>Gear Genix â€” College Equipment Booking</title>

  <style>
    *, *::before, *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    :root {
      --bg-base: #0f172a;
      --bg-sidebar: #0b1120;
      --bg-chat: #111827;
      --bg-input: #1e293b;
      --bg-user-msg: #1d4ed8;
      --bg-bot-msg: #1e293b;
      --accent: #3b82f6;
      --text-primary: #f1f5f9;
      --text-muted: #94a3b8;
      --border: #1e293b;
      --radius: 12px;
    }

    html, body {
      width: 100%;
      height: 100%;
      overflow: hidden;
      background: var(--bg-base);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto;
      color: var(--text-primary);
    }

    /* â”€â”€ APP ROOT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .app {
      height: 100%;
      display: flex;
      flex-direction: column;
      background: var(--bg-chat);
    }

    /* â”€â”€ HEADER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .header {
      flex-shrink: 0;
      padding: 14px 16px;
      background: var(--bg-sidebar);
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .dot {
      width: 8px;
      height: 8px;
      background: #22c55e;
      border-radius: 50%;
    }

    /* â”€â”€ QUICK ACTIONS (NEVER HIDE) â”€â”€â”€â”€â”€â”€â”€ */
    .quick-actions {
      flex-shrink: 0;
      display: flex;
      gap: 8px;
      padding: 10px;
      overflow-x: auto;
      background: var(--bg-chat);
      border-bottom: 1px solid var(--border);
    }

    .quick-btn {
      background: #1e293b;
      border: 1px solid var(--border);
      color: var(--text-primary);
      border-radius: 8px;
      padding: 8px 12px;
      font-size: 0.8rem;
      white-space: nowrap;
      cursor: pointer;
    }

    /* â”€â”€ MESSAGES (ONLY SCROLL AREA) â”€â”€â”€â”€â”€â”€ */
    .messages {
      flex: 1;
      min-height: 0;
      overflow-y: auto;
      padding: 14px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      overscroll-behavior: contain;
    }

    .msg {
      display: flex;
      gap: 8px;
      align-items: flex-end;
    }

    .msg.user {
      flex-direction: row-reverse;
    }

    .bubble {
      max-width: 72%;
      padding: 10px 14px;
      border-radius: var(--radius);
      font-size: 0.88rem;
      line-height: 1.6;
      white-space: pre-wrap;
      word-break: break-word;
    }

    .bot .bubble {
      background: var(--bg-bot-msg);
      border-bottom-left-radius: 4px;
    }

    .user .bubble {
      background: var(--bg-user-msg);
      color: #fff;
      border-bottom-right-radius: 4px;
    }

    /* â”€â”€ INPUT BAR (NO FIXED POSITION) â”€â”€â”€â”€ */
    .input-bar {
      flex-shrink: 0;
      display: flex;
      gap: 10px;
      padding: 10px;
      background: var(--bg-sidebar);
      border-top: 1px solid var(--border);
    }

    textarea {
      flex: 1;
      resize: none;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: var(--bg-input);
      color: var(--text-primary);
      padding: 10px 14px;
      font-size: 16px; /* ğŸ”´ prevents iOS zoom */
      max-height: 120px;
      line-height: 1.5;
    }

    textarea:focus {
      outline: none;
      border-color: var(--accent);
    }

    button.send {
      width: 42px;
      height: 42px;
      border-radius: 50%;
      border: none;
      background: var(--accent);
      color: #fff;
      cursor: pointer;
    }
  </style>
</head>

<body>

<div class="app">
  <!-- HEADER -->
  <div class="header">
    <div class="dot"></div>
    <strong>Gear Genix</strong>
  </div>

  <!-- QUICK ACTIONS -->
  <div class="quick-actions">
    <button class="quick-btn" onclick="prefill('What equipment do you have?')">ğŸ“¦ List Equipment</button>
    <button class="quick-btn" onclick="prefill('I want to book equipment')">ğŸ“… Book</button>
    <button class="quick-btn" onclick="prefill('Show my bookings')">ğŸ“‹ My Bookings</button>
    <button class="quick-btn" onclick="prefill('I want to return equipment')">ğŸ”„ Return</button>
  </div>

  <!-- MESSAGES -->
  <div class="messages" id="messages"></div>

  <!-- INPUT -->
  <div class="input-bar">
    <textarea
      id="input"
      rows="1"
      placeholder="Ask me about equipment, bookings, availabilityâ€¦"
    ></textarea>
    <button class="send" id="sendBtn">â¤</button>
  </div>
</div>

<script>
  /* â”€â”€ SESSION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  const sessionId = crypto.randomUUID();

  /* â”€â”€ DOM REFS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  const messages = document.getElementById('messages');
  const input = document.getElementById('input');
  const sendBtn = document.getElementById('sendBtn');

  /* â”€â”€ HELPERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  function scrollBottom() {
    messages.scrollTop = messages.scrollHeight;
  }

  function addMessage(text, role) {
    const m = document.createElement('div');
    m.className = 'msg ' + role;

    const bubble = document.createElement('div');
    bubble.className = 'bubble';
    bubble.innerHTML = text
      .replace(/&/g, '&amp;')
      .replace(/</g, '&lt;')
      .replace(/>/g, '&gt;')
      .replace(/\n/g, '<br>');

    m.appendChild(bubble);
    messages.appendChild(m);
    scrollBottom();
  }

  function showTyping() {
    const t = document.createElement('div');
    t.className = 'msg bot';
    t.id = 'typing';
    t.innerHTML = `<div class="bubble">Typingâ€¦</div>`;
    messages.appendChild(t);
    scrollBottom();
  }

  function hideTyping() {
    document.getElementById('typing')?.remove();
  }

  function prefill(text) {
    input.value = text;
    input.focus();
  }

  /* â”€â”€ SEND MESSAGE (BACKEND CONNECTED) â”€â”€â”€ */
  async function send() {
    const text = input.value.trim();
    if (!text) return;

    addMessage(text, 'user');
    input.value = '';
    sendBtn.disabled = true;
    showTyping();

    try {
      const res = await fetch('/chat', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          message: text,
          session_id: sessionId
        })
      });

      hideTyping();

      if (!res.ok) {
        addMessage(`âš ï¸ Server error (${res.status})`, 'bot');
      } else {
        const data = await res.json();
        addMessage(data.response || '(no response)', 'bot');
      }
    } catch (err) {
      hideTyping();
      addMessage(`âš ï¸ Network error: ${err.message}`, 'bot');
    } finally {
      sendBtn.disabled = false;
      input.focus();
    }
  }

  /* â”€â”€ EVENTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  sendBtn.addEventListener('click', send);

  input.addEventListener('keydown', (e) => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      send();
    }
  });

  /* â”€â”€ ORIGINAL WELCOME MESSAGE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  addMessage(
`ğŸ‘‹ Welcome to Gear Genix â€” College Equipment Booking Assistant!

I can help you:
â€¢ ğŸ“¦ Check what equipment is available
â€¢ ğŸ” Check availability for a time slot
â€¢ ğŸ“… Book equipment for your club
â€¢ ğŸ“‹ View your club's bookings
â€¢ âŒ Cancel a booking
â€¢ ğŸ”„ Return equipment

Just tell me what you need in plain English!
Example: "Is the projector free tomorrow 3â€“5pm?"`,
  'bot'
  );
</script>

</body>
</html>